<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ˜Ÿè·¯å¼• V9.5 - ä¸¥æ ¼å¯åŠ¨å¸ƒå±€ç‰ˆ</title>
    <!-- Tailwind CSS for mobile aesthetics -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    
    <!-- Firebase/Firestore Modules -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, addDoc, setDoc, deleteDoc, onSnapshot, collection, serverTimestamp, setLogLevel, query, orderBy, limit } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        setLogLevel('Debug');

        // --- GLOBAL STATE AND DATA ---
        let app, db, auth;
        let userId = null;
        let isAuthReady = false;
        let guides = []; 
        let currentGuide = null; 
        let currentView = 'ASSESSMENT'; // Default start view after login/load
        
        // Firestore Path Variables
        const appId ="1:166128176088:web:a2179bd66ae9265c88c0ad"
        const firebaseConfig={
  apiKey: "AIzaSyAI2EmQB26Fr6JxeJl5DmWR0OnEX45sUNg",
  authDomain: "xly9-34ea0.firebaseapp.com",
  projectId: "xly9-34ea0",
  storageBucket: "xly9-34ea0.firebasestorage.app",
  messagingSenderId: "166128176088",
  appId: "1:166128176088:web:a2179bd66ae9265c88c0ad",
  measurementId: "G-QSD3KG7PJ4"
};
        
        let discussions = [];

        // 12 Sample Assessment Questions (Scoring: 1=å¶å°”, 2=æœ‰æ—¶, 3=ç»å¸¸)
        const assessmentQuestions = [
            "1. å­©å­æ˜¯å¦éš¾ä»¥ç†è§£ä»–äººçš„éè¯­è¨€æš—ç¤ºï¼ˆå¦‚é¢éƒ¨è¡¨æƒ…ã€æ‰‹åŠ¿ï¼‰ï¼Ÿ",
            "2. å­©å­åœ¨åŒé¾„äººç¤¾äº¤äº’åŠ¨ä¸­æ˜¯å¦æ˜¾å¾—é€€ç¼©æˆ–ä¸æ„Ÿå…´è¶£ï¼Ÿ",
            "3. å­©å­æ˜¯å¦å¯¹ç‰¹å®šå£°éŸ³ã€å…‰çº¿æˆ–è´¨åœ°è¡¨ç°å‡ºå¼ºçƒˆæˆ–å¼‚å¸¸çš„ååº”ï¼Ÿ",
            "4. å­©å­æ˜¯å¦è¡¨ç°å‡ºé‡å¤çš„èº«ä½“åŠ¨ä½œæˆ–åˆ»æ¿è¡Œä¸ºï¼ˆå¦‚æ‘‡æ™ƒã€æ‹æ‰‹ï¼‰ï¼Ÿ",
            "5. å­©å­åœ¨éœ€è¦æƒ³è±¡åŠ›çš„æ¸¸æˆæˆ–æ´»åŠ¨ä¸­æ˜¯å¦æ„Ÿåˆ°å›°éš¾ï¼Ÿ",
            "6. å­©å­åœ¨æ—¥å¸¸ä¾‹è¡Œç¨‹åºæ”¹å˜æ—¶æ˜¯å¦ä¼šè¡¨ç°å‡ºæåº¦ä¸å®‰ï¼Ÿ",
            "7. å­©å­åœ¨è¡¨è¾¾è‡ªå·±çš„éœ€æ±‚æˆ–æƒ…æ„Ÿæ—¶ï¼Œæ˜¯å¦ä½¿ç”¨é‡å¤æˆ–éåŠŸèƒ½æ€§çš„è¯­è¨€ï¼Ÿ",
            "8. å­©å­æ˜¯å¦éš¾ä»¥ç»´æŒçœ¼ç¥äº¤æµæˆ–è¿›è¡Œç›®å…‰æ¥è§¦ï¼Ÿ",
            "9. å­©å­æ˜¯å¦æ²‰è¿·äºç‰¹å®šç‰©å“æˆ–ä¸»é¢˜ï¼Œå¹¶è¡¨ç°å‡ºå¼ºçƒˆçš„ä¸“æ³¨åŠ›ï¼Ÿ",
            "10. å­©å­åœ¨éœ€è¦åä½œæˆ–è½®æµçš„æ´»åŠ¨ä¸­ï¼Œæ˜¯å¦éš¾ä»¥å‚ä¸ï¼Ÿ",
            "11. å­©å­æ˜¯å¦æ‹¥æœ‰è¶…è¶ŠåŒé¾„äººçš„æŸäº›æœºæ¢°è®°å¿†èƒ½åŠ›ï¼Ÿ",
            "12. å­©å­æ˜¯å¦å¯¹ç–¼ç—›æˆ–æ¸©åº¦ç­‰åˆºæ¿€è¡¨ç°å‡ºå¼‚å¸¸çš„ä½ååº”ï¼Ÿ"
        ];
        
        // --- FIRESTORE UTILS ---
        function getGuidesCollectionRef() {
            if (!db || !userId) return null;
            return collection(db, `artifacts/${appId}/users/${userId}/star_guides`);
        }
        
        function getDiscussionCollectionRef() {
            if (!db) return null;
            return collection(db, `artifacts/${appId}/public/data/discussions`);
        }

        // --- FIREBASE INITIALIZATION & AUTH ---
        try {
            if (Object.keys(firebaseConfig).length > 0) {
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                
                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        userId = user.uid;
                    } else {
                        await signInAnonymously(auth);
                        userId = auth.currentUser.uid;
                    }
                    isAuthReady = true;
                    setupFirestoreListeners();
                });

                if (typeof __initial_auth_token !== 'undefined') {
                    await signInWithCustomToken(auth, __initial_auth_token);
                }

            } else {
                console.error('Firebase config is missing.');
            }
        } catch (error) {
            console.error('Firebase initialization failed:', error);
        }

        // --- FIRESTORE LISTENERS ---
        function setupFirestoreListeners() {
            const guidesRef = getGuidesCollectionRef();
            if (guidesRef) {
                onSnapshot(guidesRef, (snapshot) => {
                    guides = snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    })).sort((a, b) => (b.updated_at?.toMillis() || 0) - (a.updated_at?.toMillis() || 0));
                    
                    document.getElementById('loading-state').style.display = 'none';

                    if (!currentGuide && guides.length > 0) {
                        loadGuide(guides[0].id);
                    } else if (!currentGuide) {
                        // Show the dedicated launch screen
                         updateAppLayout(false); 
                    }
                    
                    renderGuideList();
                    if (currentGuide && !guides.some(g => g.id === currentGuide.id)) {
                        clearGuideView();
                    }
                }, (error) => {
                    console.error(`åŠ è½½å¤±è´¥: ${error.message}`);
                });
            }
            
            // Discussion Listener setup here (omitted for brevity, assume it works)
            const discussionRef = getDiscussionCollectionRef();
            if (discussionRef) {
                const q = query(discussionRef, orderBy('timestamp', 'desc'), limit(20));
                onSnapshot(q, (snapshot) => {
                    discussions = snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data(),
                        displayTime: doc.data().timestamp ? new Date(doc.data().timestamp.toMillis()).toLocaleString() : 'åˆšåˆš'
                    }));
                    if (currentView === 'DISCUSSION') {
                        renderDiscussion(document.getElementById('content-area-main'));
                    }
                }, (error) => {
                    console.error("åŠ è½½è®¨è®ºåŒºå¤±è´¥:", error);
                });
            }
        }
        
        // --- APP FLOW AND UI CONTROL ---

        function updateAppLayout(isLaunched) {
            const mainHeader = document.getElementById('app-main-header');
            const mainContent = document.getElementById('app-main-content-wrapper');
            const mainNav = document.getElementById('app-main-nav');
            const launchScreen = document.getElementById('launch-screen');

            if (isLaunched) {
                // Show main app UI
                mainHeader.classList.remove('hidden');
                mainContent.classList.remove('hidden');
                mainNav.classList.remove('hidden');
                launchScreen.classList.add('hidden');
            } else {
                // Show launch screen UI (50/50)
                mainHeader.classList.add('hidden');
                mainContent.classList.add('hidden');
                mainNav.classList.add('hidden');
                launchScreen.classList.remove('hidden');
            }
        }

        window.loadGuide = function(guideId) {
            const guide = guides.find(g => g.id === guideId);
            if (!guide) return;
            currentGuide = guide;
            document.getElementById('profile-creation-modal').classList.add('hidden');
            updateAppLayout(true); // Switch to main app layout
            switchView('ASSESSMENT'); 
            renderGuideList();
        }
        
        window.clearGuideView = function() {
            currentGuide = null;
            updateAppLayout(false); // Switch back to launch screen
            document.getElementById('content-area-main').innerHTML = '';
            renderGuideList();
        }

        function updateDisplayArea(guide) {
            const mainQuote = document.getElementById('main-quote');
            const quoteSource = document.getElementById('quote-source');
            const progressContainer = document.getElementById('progress-container');

            if (!guide) {
                // Should not happen when in main view, but safety first
                mainQuote.textContent = 'æ¬¢è¿æ¥åˆ°æ˜Ÿè·¯å¼•';
                quoteSource.textContent = 'æ‚¨çš„è‚²å„¿æˆé•¿åŠ©æ‰‹ã€‚';
                progressContainer.classList.add('hidden');
            } else {
                const quote = guide.quote || 'ä¸“æ³¨å½“ä¸‹ï¼Œæˆå°±æœªæ¥';

                mainQuote.textContent = quote;
                quoteSource.textContent = `æ¡£æ¡ˆ: ${guide.name || 'æœªå‘½å'} | ${guide.age || '?'}å², ${guide.province || 'æœªçŸ¥çœä»½'}`;
                progressContainer.classList.remove('hidden');
                
                // Progress bar update logic (omitted for brevity, same as previous version)
                const progress = guide.progress || 0;
                const progressText = document.getElementById('progress-text-main');
                const progressBar = document.getElementById('progress-bar-main');
                if (progressText) progressText.textContent = `${progress}%`;
                if (progressBar) progressBar.style.width = `${progress}%`;
                let color = 'bg-gray-400';
                if (progress >= 100) color = 'bg-purple-400';
                else if (progress >= 75) color = 'bg-green-400';
                else if (progress >= 40) color = 'bg-yellow-400';
                else color = 'bg-red-400';
                if (progressBar) progressBar.className = `progress-bar h-1.5 rounded-full ${color}`;
            }
        }
        
        window.switchView = function(viewName) {
            if (!currentGuide && viewName !== 'DISCUSSION') {
                updateAppLayout(false); // Go back to launch screen if no profile selected
                return;
            }

            currentView = viewName;
            document.querySelectorAll('.nav-button').forEach(btn => {
                btn.classList.remove('bg-blue-600', 'text-white');
                btn.classList.add('text-gray-500', 'bg-white');
            });
            document.getElementById(`nav-${viewName.toLowerCase()}`).classList.add('bg-blue-600', 'text-white');
            document.getElementById(`nav-${viewName.toLowerCase()}`).classList.remove('text-gray-500', 'bg-white');
            
            const contentArea = document.getElementById('content-area-main');
            contentArea.innerHTML = ''; 

            updateDisplayArea(currentGuide);

            switch (viewName) {
                case 'ASSESSMENT':
                    renderAssessment(contentArea);
                    break;
                case 'DAILY_LOG':
                    renderDailyLog(contentArea);
                    break;
                case 'DISCUSSION':
                    renderDiscussion(contentArea);
                    break;
                case 'PRO_SERVICE':
                    renderProService(contentArea);
                    break;
            }
        }
        
        // --- MODULE RENDERING ---

        // Assessment Module
        function renderAssessment(container) {
            const hasResult = currentGuide.lastAssessmentScore !== undefined && currentGuide.lastAssessmentScore !== null;
            
            let assessmentContent = `
                <h2 class="text-2xl font-bold text-gray-800 mb-6 border-b pb-2">ğŸ§  æµ‹è¯„æ¨¡å— (${currentGuide.name}æ¡£æ¡ˆ)</h2>
                
                ${hasResult ? `
                    <div class="p-4 mb-6 bg-green-100 rounded-xl shadow-md border-l-4 border-green-500">
                        <h3 class="text-xl font-bold text-green-700 mb-2">ğŸ“Š ä¸Šæ¬¡æµ‹è¯„ç»“æœå›é¡¾</h3>
                        <p class="text-sm mt-1 leading-relaxed">ä¸Šæ¬¡å¾—åˆ†: ${currentGuide.lastAssessmentScore || 0}åˆ†ã€‚ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®è¿›è¡Œå¤æµ‹ã€‚</p>
                        <button onclick="showAssessmentResultModal(generateSimpleResultObject(${currentGuide.lastAssessmentScore || 0}, ${assessmentQuestions.length * 3}))" 
                                class="mt-3 py-1 px-4 bg-green-500 text-white rounded-full text-xs hover:bg-green-600 transition">
                            æŸ¥çœ‹è¯¦ç»†ç»“æœ
                        </button>
                    </div>
                ` : `
                    <div class="p-4 mb-6 bg-yellow-100 rounded-xl shadow-md border-l-4 border-yellow-500">
                        <h3 class="text-xl font-bold text-yellow-700 mb-2">å¼€å§‹é¦–æ¬¡æµ‹è¯„ (12é¢˜)</h3>
                        <p class="text-sm">è¯·ä»”ç»†é˜…è¯»ä»¥ä¸‹æµ‹è¯„é¢˜ï¼Œæ ¹æ®å­©å­çš„è¡Œä¸ºé¢‘ç‡è¿›è¡Œæ‰“åˆ†ã€‚</p>
                    </div>
                `}

                <!-- Assessment Questions Form -->
                <form id="assessment-form" class="space-y-4">
                    ${assessmentQuestions.map((q, index) => `
                        <div class="p-4 bg-white rounded-lg shadow-sm border border-gray-200">
                            <label class="block text-sm font-semibold text-gray-700 mb-3">${q}</label>
                            <div class="flex justify-between space-x-2 text-center text-xs">
                                <label class="flex-1 p-2 border rounded-full hover:bg-red-50 transition cursor-pointer">
                                    <input type="radio" name="q${index}" value="3" required> ç»å¸¸ (3åˆ†)
                                </label>
                                <label class="flex-1 p-2 border rounded-full hover:bg-yellow-50 transition cursor-pointer">
                                    <input type="radio" name="q${index}" value="2" required> æœ‰æ—¶ (2åˆ†)
                                </label>
                                <label class="flex-1 p-2 border rounded-full hover:bg-green-50 transition cursor-pointer">
                                    <input type="radio" name="q${index}" value="1" required> å¶å°” (1åˆ†)
                                </label>
                            </div>
                        </div>
                    `).join('')}
                    
                    <button type="submit" class="w-full py-3 bg-blue-600 text-white font-bold rounded-xl shadow-lg hover:bg-blue-700 transition">
                        æäº¤æµ‹è¯„å¾—åˆ†
                    </button>
                    <div class="text-sm text-center mt-2 text-gray-500" id="assessment-status"></div>
                </form>
            `;
            container.innerHTML = assessmentContent;
            document.getElementById('assessment-form').addEventListener('submit', handleAssessmentSubmit);
        }

        // Generate Result Object
        function generateSimpleResultObject(score, maxScore) {
            const thresholdHigh = Math.ceil(maxScore * 0.7); 
            const thresholdMedium = Math.ceil(maxScore * 0.4); 
            
            let level, resultText, guidanceText;
            
            if (score >= thresholdHigh) {
                level = "æŒ‘æˆ˜å…³æ³¨çº§";
                resultText = "è¯„ä¼°æ˜¾ç¤ºå­©å­çš„æŒ‘æˆ˜è¡Œä¸ºé¢‘ç‡è¾ƒé«˜ï¼Œå¯èƒ½å­˜åœ¨ç¤¾äº¤ã€æ²Ÿé€šæˆ–è¡Œä¸ºæ¨¡å¼ä¸Šçš„æ˜¾è‘—å·®å¼‚ã€‚éœ€ç»“åˆç¯å¢ƒå› ç´ å’ŒåŒ»é™¢è¯Šæ–­è¿›è¡Œç»¼åˆåˆ¤æ–­ã€‚";
                guidanceText = "å»ºè®®ï¼š**ç«‹å³å¯»æ±‚ä¸“ä¸šæœºæ„è¯„ä¼°**ã€‚æ—¥å¸¸ä»¥ç»“æ„åŒ–æ•™å­¦å’Œæ˜ç¡®æŒ‡ä»¤ä¸ºä¸»ï¼Œå¤šè¿›è¡Œçœ¼ç¥äº¤æµå’Œè½®æµæ¸¸æˆè®­ç»ƒã€‚";
            } else if (score >= thresholdMedium) {
                level = "å‘å±•è§‚å¯Ÿçº§";
                resultText = "å­©å­è¡¨ç°å‡ºä¸­åº¦æŒ‘æˆ˜ï¼Œé›†ä¸­åœ¨ç‰¹å®šæƒ…å¢ƒæˆ–å…´è¶£ä¸Šã€‚ç¯å¢ƒé€‚åº”æ€§å’ŒåŒä¼´äº¤å¾€æ˜¯å…³é”®ã€‚è¿™å¯èƒ½å—å®¶åº­æˆ–æ•™è‚²ç¯å¢ƒå½±å“ã€‚";
                guidanceText = "å»ºè®®ï¼š**åŠ å¼ºæƒ…æ™¯æ¨¡æ‹Ÿå’Œæƒ…ç»ªç†è§£è®­ç»ƒ**ã€‚å°è¯•å°æ­¥å¿«è·‘åŸåˆ™ï¼Œå¥–åŠ±ç§¯æè¡Œä¸ºï¼Œå¹¶å»ºç«‹ç¨³å®šçš„ä½œæ¯ã€‚";
            } else {
                level = "å¸¸è§„å‘å±•çº§";
                resultText = "å­©å­è¡Œä¸ºæ€»ä½“ç¨³å®šï¼ŒæŒ‘æˆ˜è¡Œä¸ºè¾ƒå°‘ã€‚æ—¥å¸¸å…³æ³¨ç‚¹åœ¨äºä¿ƒè¿›æ›´ä¸°å¯Œã€çµæ´»çš„ç¤¾äº¤äº’åŠ¨å’Œå…´è¶£å‘å±•ã€‚";
                guidanceText = "å»ºè®®ï¼š**ç»§ç»­ä¿æŒè§‚å¯Ÿè®°å½•**ã€‚é¼“åŠ±å­©å­å‚ä¸æ›´å¤æ‚çš„é›†ä½“æ´»åŠ¨ï¼Œæ‹“å±•æ–°çš„çˆ±å¥½ï¼Œæå‡å…¶ä¸»åŠ¨æ²Ÿé€šæ„æ„¿ã€‚";
            }
            
            return { score, maxScore, level, resultText, guidanceText };
        }

        // Assessment Result Modal Handler
        window.showAssessmentResultModal = function(result) {
            const modal = document.getElementById('assessment-result-modal');
            
            document.getElementById('result-score').textContent = `${result.score} / ${result.maxScore} åˆ†`;
            document.getElementById('result-level').textContent = result.level;
            document.getElementById('result-summary').innerHTML = `ã€æ¦‚è¦ã€‘${result.resultText}`;
            document.getElementById('result-guidance').innerHTML = `ã€æŒ‡å¯¼ã€‘${result.guidanceText}`;

            modal.classList.remove('hidden');
        }
        
        async function handleAssessmentSubmit(event) {
            event.preventDefault();
            const form = event.target;
            let totalScore = 0;
            let allAnswered = true;
            const status = document.getElementById('assessment-status');
            status.textContent = 'æ­£åœ¨è®¡ç®—å¾—åˆ†...';

            for (let i = 0; i < assessmentQuestions.length; i++) {
                const selector = `input[name="q${i}"]:checked`;
                const input = form.querySelector(selector);
                if (input) {
                    totalScore += parseInt(input.value, 10);
                } else {
                    allAnswered = false;
                    break;
                }
            }

            if (!allAnswered) {
                status.textContent = 'âš ï¸ è¯·å®Œæˆå…¨éƒ¨12é“é¢˜åæäº¤ã€‚';
                status.classList.add('text-red-500');
                return;
            }
            
            const resultData = generateSimpleResultObject(totalScore, assessmentQuestions.length * 3);

            // Save the score to Firestore
            const data = { 
                lastAssessmentScore: totalScore, 
                assessmentDate: serverTimestamp(),
                progress: Math.min(currentGuide.progress || 0, 25) + 25 
            };
            const guideDocRef = doc(getGuidesCollectionRef(), currentGuide.id);

            try {
                await setDoc(guideDocRef, data, { merge: true });
                currentGuide.lastAssessmentScore = totalScore; 
                currentGuide.progress = data.progress; // Update local state
                
                status.textContent = 'âœ… å¾—åˆ†ä¿å­˜æˆåŠŸï¼';
                
                // CRITICAL: Show the result modal immediately
                showAssessmentResultModal(resultData);
                
                // Re-render assessment view in the background to show history
                switchView('ASSESSMENT'); 

            } catch (error) {
                status.textContent = `âŒ ä¿å­˜å¤±è´¥: ${error.message}`;
            }
        }

        // Daily Log Module (Supports Text, Mocking Image/Voice)
        function renderDailyLog(container) {
             container.innerHTML = `
                <h2 class="text-2xl font-bold text-gray-800 mb-6 border-b pb-2">ğŸ“ æ¯æ—¥è®°å½• (${currentGuide.name}æ¡£æ¡ˆ)</h2>
                
                <div class="p-4 mb-4 bg-white rounded-xl shadow-md border-l-4 border-orange-500">
                    <h3 class="text-xl font-semibold mb-2">è®°å½•ä»Šå¤©çš„è¿›å±•</h3>
                    
                    <div class="flex space-x-3 mb-4">
                        <button class="flex-1 py-2 bg-gray-100 text-gray-700 rounded-lg border hover:bg-gray-200 transition">ğŸ–¼ï¸ (åŠŸèƒ½å ä½) ä¸Šä¼ å›¾ç‰‡</button>
                        <button class="flex-1 py-2 bg-gray-100 text-gray-700 rounded-lg border hover:bg-gray-200 transition">ğŸ¤ (åŠŸèƒ½å ä½) å½•åˆ¶è¯­éŸ³</button>
                    </div>

                    <p class="text-gray-600 text-sm mb-2">æ–‡æœ¬è®°å½•ï¼š</p>
                    <textarea id="daily-log-input" rows="4" placeholder="è®°å½•ä»Šå¤©çš„å…³é”®äº‹ä»¶ã€æƒ…ç»ªã€å¹²é¢„åé¦ˆ..." class="w-full p-2 border border-gray-300 rounded-lg mb-2 focus:ring-orange-500"></textarea>
                    <button onclick="saveDailyLog()" class="w-full py-2 bg-orange-500 text-white font-bold rounded-lg hover:bg-orange-600">
                        æäº¤è®°å½•
                    </button>
                    <div id="log-status" class="text-sm text-center mt-2 text-gray-500"></div>
                </div>
                
                <h3 class="text-xl font-bold text-gray-700 mt-6 mb-3">ğŸ“„ æŠ¥å‘Šä¸è¿›å±•</h3>
                <div class="space-y-4">
                    <div class="p-4 bg-white rounded-xl shadow-md border-l-4 border-teal-500">
                        <p class="font-bold mb-2">è¿›æ­¥è¿›å±•è¯´æ˜:</p>
                        <p class="text-gray-600 text-sm mb-3">åŸºäºæ‚¨çš„è®°å½•å’Œæµ‹è¯„æ•°æ®ï¼Œè¯´æ˜å­©å­çš„è¿›æ­¥è¿›å±•ã€‚</p>
                        <div class="flex space-x-2">
                            <button class="flex-1 py-2 bg-teal-500 text-white font-bold rounded-lg hover:bg-teal-600">ç”Ÿæˆå‘¨æŠ¥å‘Š</button>
                            <button class="flex-1 py-2 bg-teal-600 text-white font-bold rounded-lg hover:bg-teal-700">ç”ŸæˆæœˆæŠ¥å‘Š</button>
                        </div>
                    </div>
                    <div class="p-3 bg-gray-100 rounded-lg text-sm text-gray-600">å†å²è®°å½•ç¤ºä¾‹: 2025/11/29: æˆåŠŸå®Œæˆäº†ç¬¬ä¸€æ¬¡æµ‹è¯„ï¼Œå¾—åˆ†30åˆ†ã€‚</div>
                </div>
            `;
        }
        
        async function saveDailyLog() {
            // Log saving logic (omitted for brevity, same as previous version)
            const logText = document.getElementById('daily-log-input').value.trim();
            const logStatus = document.getElementById('log-status');
            
            if (!logText) { logStatus.textContent = 'è®°å½•å†…å®¹ä¸èƒ½ä¸ºç©ºã€‚'; return; }
            if (!currentGuide || !isAuthReady) { logStatus.textContent = 'æ¡£æ¡ˆæœªåŠ è½½ï¼Œæ— æ³•ä¿å­˜ã€‚'; return; }

            const logsCollectionRef = collection(db, `artifacts/${appId}/users/${userId}/star_guides/${currentGuide.id}/daily_logs`);
            
            try {
                logStatus.textContent = 'æ­£åœ¨æäº¤...';
                await addDoc(logsCollectionRef, {
                    text: logText,
                    timestamp: serverTimestamp(),
                    guideId: currentGuide.id
                });
                logStatus.textContent = 'âœ… è®°å½•æäº¤æˆåŠŸï¼';
                document.getElementById('daily-log-input').value = '';
                setTimeout(() => logStatus.textContent = '', 3000);
            } catch (error) {
                logStatus.textContent = `âŒ è®°å½•æäº¤å¤±è´¥: ${error.message}`;
            }
        }


        // Discussion Module (Public Data) (omitted for brevity, same as previous version)
        function renderDiscussion(container) {
            let discussionListHtml = discussions.map(post => `
                <div class="p-3 bg-white rounded-lg shadow-sm border-l-4 border-gray-300">
                    <p class="text-gray-800 font-medium">${post.text}</p>
                    <p class="text-xs text-gray-500 mt-1">
                        <span class="font-bold text-blue-500">${post.userName || 'åŒ¿åå®¶é•¿'}</span> 
                        | ${post.displayTime}
                    </p>
                </div>
            `).join('');

            container.innerHTML = `
                <h2 class="text-2xl font-bold text-gray-800 mb-6 border-b pb-2">ğŸ’¬ è®¨è®ºäº¤æµåŒº</h2>
                
                <div class="mb-6 p-4 bg-indigo-100 rounded-xl">
                    <h3 class="text-lg font-bold text-indigo-700 mb-2">åˆ†äº«ä½ çš„ç»éªŒæˆ–å»ºè®®</h3>
                    <textarea id="discussion-input" rows="3" placeholder="åˆ†äº«å­©å­è¿›å±•ã€è½¯ä»¶ä½¿ç”¨å»ºè®®ç­‰..." class="w-full p-2 border border-gray-300 rounded-lg mb-3 focus:ring-indigo-500"></textarea>
                    <div class="flex justify-end items-center">
                        <input type="text" id="discussion-username" class="w-2/5 p-2 mr-3 border border-gray-300 rounded-lg text-sm" placeholder="æ‚¨çš„åå­—(å¯é€‰)">
                        <button onclick="submitDiscussionPost()" class="w-3/5 py-2 bg-indigo-600 text-white font-bold rounded-lg hover:bg-indigo-700 transition">
                            å‘å¸ƒåˆ†äº«
                        </button>
                    </div>
                    <div id="discussion-status" class="text-sm text-center mt-2 text-gray-500"></div>
                </div>

                <h3 class="text-xl font-bold text-gray-700 mt-6 mb-3">æœ€æ–°è®¨è®º</h3>
                <div id="discussion-list" class="space-y-3">
                    ${discussionListHtml.length > 0 ? discussionListHtml : '<p class="text-gray-500">æš‚æ— è®¨è®ºå†…å®¹ï¼Œå¿«æ¥æˆä¸ºç¬¬ä¸€ä¸ªå‘è¨€çš„äººå§ï¼</p>'}
                </div>
            `;
        }

        async function submitDiscussionPost() {
            // Discussion submission logic (omitted for brevity, same as previous version)
            const postText = document.getElementById('discussion-input').value.trim();
            const userName = document.getElementById('discussion-username').value.trim() || 'çƒ­å¿ƒå®¶é•¿';
            const postStatus = document.getElementById('discussion-status');
            
            if (!postText) { postStatus.textContent = 'å†…å®¹ä¸èƒ½ä¸ºç©ºã€‚'; return; }
            if (!isAuthReady) { postStatus.textContent = 'è®¤è¯æœªå®Œæˆï¼Œæ— æ³•å‘å¸ƒã€‚'; return; }

            const discussionRef = getDiscussionCollectionRef();
            
            try {
                postStatus.textContent = 'æ­£åœ¨å‘å¸ƒ...';
                await addDoc(discussionRef, {
                    text: postText,
                    userName: userName,
                    userId: userId, 
                    timestamp: serverTimestamp()
                });
                postStatus.textContent = 'âœ… å‘å¸ƒæˆåŠŸï¼';
                document.getElementById('discussion-input').value = '';
                document.getElementById('discussion-username').value = '';
                setTimeout(() => postStatus.textContent = '', 3000);
            } catch (error) {
                postStatus.textContent = `âŒ å‘å¸ƒå¤±è´¥: ${error.message}`;
            }
        }

        // Professional Service Module (omitted for brevity, same as previous version)
        function renderProService(container) {
             container.innerHTML = `
                <h2 class="text-2xl font-bold text-gray-800 mb-6 border-b pb-2">ğŸ“ ä¸“ä¸šæœåŠ¡ç”³è¯·</h2>
                <div class="p-4 bg-white rounded-xl shadow-md border-l-4 border-red-500 space-y-3">
                    <h3 class="text-xl font-bold text-red-600 mb-2">â­ ä»˜è´¹ä¸“ä¸šæµ‹è¯„ä¸æŒ‡å¯¼</h3>
                    <p class="text-lg font-semibold text-gray-800">
                        ä¸“ä¸šæµ‹è¯„ç»“æœï¼š<span class="text-sm font-normal text-gray-500">(æ ¹æ®å›½å†…å¤–è¯Šæ–­æ ‡å‡†å’Œç¯å¢ƒå› ç´ )</span>
                    </p>
                    <ul class="list-disc list-inside space-y-2 text-gray-700 ml-4 text-base">
                        <li>**å¤šè§’åº¦ã€å¤šç»´åº¦ç²¾å‡†åˆ†æ**ï¼šç»“åˆè‡ªé—­ç—‡ã€ç¤¾äº¤éšœç¢ã€æ™ºåŠ›å‘è‚²è¿Ÿç¼“ç­‰ä¸»æµè¯Šæ–­è¦ç´ ã€‚</li>
                        <li>**å®šåˆ¶åŒ–å¹²é¢„è·¯å¾„**ï¼šåŸºäºæ‚¨çš„æ¡£æ¡ˆå’Œæµ‹è¯„ç»“æœï¼Œå‡ºå…·ä¸ªä½“åŒ–çš„è®­ç»ƒå’Œæ•™è‚²æ–¹æ¡ˆã€‚</li>
                        <li>**1v1 çº¿ä¸Šä¸“ä¸šç£å¯¼**</li>
                        <li>**30å¤©é’ˆå¯¹æ€§è®­ç»ƒè®¡åˆ’**</li>
                    </ul>

                    <div class="mt-4 pt-3 border-t border-gray-200">
                        <p class="font-bold text-blue-600 mb-1">è”ç³»æ¸ é“ï¼š</p>
                        <a href="mailto:pro-guidance@xingluyin.com" class="block text-blue-500 hover:text-blue-700 underline text-base">
                            pro-guidance@xingluyin.com
                        </a>
                        <p class="text-sm text-gray-500 mt-2">è¯·åœ¨é‚®ä»¶ä¸­é™„ä¸Šæ‚¨çš„ç”¨æˆ·IDï¼Œæ–¹ä¾¿æˆ‘ä»¬æ‰¾åˆ°æ‚¨çš„æ¡£æ¡ˆã€‚</p>
                    </div>
                </div>
            `;
        }

        // --- PROFILE CREATION MODAL & UTILS ---
        
        window.showProfileCreationModal = function() {
            document.getElementById('profile-creation-modal').classList.remove('hidden');
        }

        window.submitNewProfile = async function() {
            const name = document.getElementById('profile-name').value.trim();
            const age = parseInt(document.getElementById('profile-age').value, 10);
            const province = document.getElementById('profile-province').value.trim();
            const status = document.getElementById('profile-creation-status');
            const button = document.getElementById('profile-creation-button');

            if (!name || isNaN(age) || age < 1 || !province) {
                status.textContent = 'è¯·å®Œæ•´å¡«å†™å§“åã€æœ‰æ•ˆå¹´é¾„å’Œçœä»½ã€‚';
                return;
            }
            
            if (!isAuthReady) { status.textContent = 'è®¤è¯æœªå®Œæˆï¼Œè¯·ç¨å€™ã€‚'; return; }

            button.disabled = true;
            status.innerHTML = 'æ­£åœ¨åˆ›å»ºæ¡£æ¡ˆ... <span class="animate-spin inline-block ml-2">ğŸŒ€</span>';

            const guidesRef = getGuidesCollectionRef();
            const newGuideData = {
                name: name,
                age: age,
                province: province,
                progress: 0,
                quote: "æ¯ä¸€æ¬¡åŠªåŠ›ï¼Œéƒ½æ˜¯æ˜Ÿæ˜Ÿåœ¨é—ªçƒã€‚",
                tasks: ["è¿›è¡Œé¦–æ¬¡æµ‹è¯„", "å»ºç«‹æ¯æ—¥è®°å½•ä¹ æƒ¯"],
                lastAssessmentScore: null,
                created_at: serverTimestamp(),
                updated_at: serverTimestamp()
            };

            try {
                const docRef = await addDoc(guidesRef, newGuideData);
                status.textContent = 'âœ… æ¡£æ¡ˆåˆ›å»ºæˆåŠŸï¼';
                
                currentGuide = { id: docRef.id, ...newGuideData }; 
                
                setTimeout(() => {
                    document.getElementById('profile-creation-modal').classList.add('hidden');
                    loadGuide(currentGuide.id); // Load the new guide and jump
                    button.disabled = false;
                }, 500);

            } catch (error) {
                status.textContent = `âŒ åˆ›å»ºå¤±è´¥: ${error.message}`;
                button.disabled = false;
            }
        }
        
        window.renderGuideList = function() {
            const listContainer = document.getElementById('guide-list');
            listContainer.innerHTML = ''; 

            guides.forEach((guide) => {
                const isActive = currentGuide && currentGuide.id === guide.id;
                const listItem = document.createElement('li');
                listItem.className = `p-2 rounded-lg cursor-pointer transition text-sm truncate ${isActive ? 'bg-blue-600 text-white font-bold' : 'bg-white text-gray-700 hover:bg-gray-200'}`;
                listItem.textContent = `${guide.name || 'æœªå‘½å'} (${guide.age || '?'}å²)`;
                listItem.onclick = () => loadGuide(guide.id);
                listContainer.appendChild(listItem);
            });
        }
        
        window.deleteCurrentGuide = async function() {
            if (!currentGuide || !isAuthReady) {
                document.getElementById('error-message').textContent = 'è¯·å…ˆé€‰æ‹©ä¸€ä¸ªæ¡£æ¡ˆè¿›è¡Œåˆ é™¤ã€‚';
                document.getElementById('error-modal').classList.remove('hidden');
                return;
            }
            document.getElementById('confirm-guide-name').textContent = currentGuide.name;
            document.getElementById('confirmation-modal').classList.remove('hidden');
        }
        
        window.performDelete = async function() {
            document.getElementById('confirmation-modal').classList.add('hidden');
            const guideId = currentGuide.id;
            const guideDocRef = doc(getGuidesCollectionRef(), guideId);
            try {
                await deleteDoc(guideDocRef); 
                clearGuideView();
                if (guides.length > 0) {
                     loadGuide(guides[0].id);
                } else {
                    updateAppLayout(false); // Show launch screen
                }
            } catch (error) {
                console.error("åˆ é™¤æ¡£æ¡ˆå¤±è´¥:", error);
                document.getElementById('error-message').textContent = 'åˆ é™¤æ¡£æ¡ˆå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•ã€‚';
                document.getElementById('error-modal').classList.remove('hidden');
            }
        }
        
        // Initial setup on load
        window.onload = () => {
            // Initially ensure launch screen is visible until auth/load decides otherwise
             updateAppLayout(false); 
        }
    </script>

    <style>
        /* APP Simulation */
        body { font-family: 'Inter', sans-serif; background-color: #e2e8f0; }
        #app-container {
            max-width: 500px; 
            margin: 0 auto;
            height: 100vh;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            background-color: #f1f5f9;
        }
        .encouragement-header { background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%); }
        .custom-scroll::-webkit-scrollbar { width: 4px; }
        .custom-scroll::-webkit-scrollbar-thumb { background-color: #94a3b8; border-radius: 2px; }
        .custom-scroll::-webkit-scrollbar-track { background: #f1f5f9; }
        .modal-bg { background-color: rgba(0, 0, 0, 0.6); }
        .nav-button:disabled { opacity: 0.6; cursor: not-allowed; }
    </style>
</head>
<body>

    <!-- ä¸»å®¹å™¨ï¼šæ¨¡æ‹Ÿæ‰‹æœºå±å¹• -->
    <div id="app-container" class="flex flex-col relative h-full">

        <!-- ============================================== -->
        <!-- A. å¯åŠ¨é¡µ (50/50 å¸ƒå±€) - é»˜è®¤æ˜¾ç¤ºï¼Œç›´åˆ°æ¡£æ¡ˆåŠ è½½ -->
        <!-- ============================================== -->
        <div id="launch-screen" class="absolute inset-0 flex flex-col transition duration-300">
            <!-- é¡¶éƒ¨ 50% é¼“åŠ±è¯­ -->
            <div class="h-1/2 flex flex-col items-center justify-center p-8 text-white text-center encouragement-header shadow-lg">
                <p class="text-4xl font-extrabold mb-3">ğŸ’« æ˜Ÿè·¯å¼•</p>
                <h1 class="text-xl font-light leading-relaxed">
                    â€œ<span class="font-semibold">è€å¿ƒå’Œçˆ±</span>ï¼Œæ˜¯ç…§äº®å­©å­ä¸–ç•Œçš„å¼•è·¯ç¯ã€‚ä½ ä¸æ˜¯ä¸€ä¸ªäººåœ¨æˆ˜æ–—ã€‚â€
                </h1>
            </div>

            <!-- åº•éƒ¨ 50% æ¡£æ¡ˆæ“ä½œå’Œæç¤º -->
            <div class="h-1/2 p-6 bg-white flex flex-col justify-between">
                <div>
                    <!-- æç¤ºè¯­ -->
                    <h2 class="text-lg font-bold text-gray-800 mb-3">ğŸ› ï¸ æ¡£æ¡ˆç®¡ç†</h2>
                    <p class="text-sm text-gray-500 mb-4">
                        è¯·å»ºç«‹å­©å­æ¡£æ¡ˆï¼Œå¯åŠ¨æ‚¨çš„ä¸ªæ€§åŒ–æˆé•¿æ—…ç¨‹ã€‚æ¡£æ¡ˆå»ºç«‹åå°†ç«‹å³è¿›å…¥ <span class="text-blue-600 font-bold">æµ‹è¯„æ¨¡å—</span>ã€‚
                    </p>
                    
                    <!-- æ¡£æ¡ˆåˆ—è¡¨ï¼ˆæŠ˜å ï¼‰ -->
                    <details class="p-2 bg-gray-50 rounded-lg border border-gray-200">
                        <summary class="font-bold text-gray-700 text-sm cursor-pointer">
                            ğŸ“‚ åˆ‡æ¢å†å²æ¡£æ¡ˆ...
                        </summary>
                        <p id="loading-state" class="text-center text-xs text-gray-400 py-2">
                            æ­£åœ¨åŠ è½½æ¡£æ¡ˆ...
                        </p>
                        <ul id="guide-list" class="space-y-1 mt-2 max-h-20 overflow-y-auto custom-scroll p-1">
                            <!-- æ¡£æ¡ˆåˆ—è¡¨å°†é€šè¿‡ JS æ¸²æŸ“ -->
                        </ul>
                    </details>
                </div>

                <!-- åº•éƒ¨æŒ‰é’® -->
                <div class="flex space-x-3 w-full mt-4">
                    <button onclick="showProfileCreationModal()" class="flex-1 py-3 bg-green-600 hover:bg-green-700 text-white font-bold rounded-xl transition shadow-lg">
                        + æ–°å»ºæ¡£æ¡ˆ
                    </button>
                    <button onclick="deleteCurrentGuide()" class="flex-1 py-3 bg-red-500 hover:bg-red-600 text-white font-bold rounded-xl transition shadow-lg">
                        åˆ é™¤æ¡£æ¡ˆ
                    </button>
                </div>
            </div>
        </div>
        
        <!-- ============================================== -->
        <!-- B. ä¸»åº”ç”¨ç•Œé¢ (ä»…æ¡£æ¡ˆåŠ è½½åæ˜¾ç¤º) -->
        <!-- ============================================== -->

        <!-- B.1 é¡¶éƒ¨é¼“åŠ±è¯­å’ŒçŠ¶æ€å±•ç¤ºåŒº -->
        <div id="app-main-header" class="encouragement-header text-white p-4 sticky top-0 z-10 shadow-md hidden">
            <div class="flex justify-between items-start mb-3">
                <div class="flex-grow min-w-0">
                    <h1 class="text-2xl font-bold tracking-tight truncate" id="main-quote"></h1>
                    <p class="text-sm font-light text-blue-200 mt-1 truncate" id="quote-source"></p>
                </div>
            </div>
            <!-- è¿›åº¦æ¡ -->
            <div id="progress-container" class="mt-2 hidden">
                <p class="text-xs font-semibold text-white mb-1">æ€»è¿›åº¦: <span id="progress-text-main">0%</span></p>
                <div class="w-full bg-gray-200/50 rounded-full h-1.5">
                    <div id="progress-bar-main" class="progress-bar bg-gray-400 h-1.5 rounded-full" style="width: 0%"></div>
                </div>
            </div>
        </div>

        <!-- B.2 æ¨¡å—ä¸­å¿ƒå†…å®¹åŒº (å¯æ»šåŠ¨) -->
        <div id="app-main-content-wrapper" class="flex-grow p-4 overflow-y-auto custom-scroll hidden">
            <div id="content-area-main">
                <!-- æ¨¡å—å†…å®¹å°†æ¸²æŸ“åˆ°è¿™é‡Œ -->
            </div>
        </div>

        <!-- B.3 å›ºå®šåº•éƒ¨å¯¼èˆªæ  (4ä¸ªæ¨¡å—) -->
        <div id="app-main-nav" class="sticky bottom-0 w-full p-2 bg-white border-t border-gray-200 shadow-xl hidden">
            <div class="grid grid-cols-4 gap-1">
                <button id="nav-assessment" onclick="switchView('ASSESSMENT')" class="nav-button flex flex-col items-center justify-center text-xs py-2 bg-blue-600 text-white rounded-lg">
                    <span class="text-lg">ğŸ§ </span> æµ‹è¯„
                </button>
                <button id="nav-daily_log" onclick="switchView('DAILY_LOG')" class="nav-button flex flex-col items-center justify-center text-xs py-2 text-gray-500 bg-white hover:bg-blue-50 rounded-lg">
                    <span class="text-lg">ğŸ“</span> è®°å½•
                </button>
                <button id="nav-discussion" onclick="switchView('DISCUSSION')" class="nav-button flex flex-col items-center justify-center text-xs py-2 text-gray-500 bg-white hover:bg-blue-50 rounded-lg">
                    <span class="text-lg">ğŸ’¬</span> è®¨è®ºåŒº
                </button>
                <button id="nav-pro_service" onclick="switchView('PRO_SERVICE')" class="nav-button flex flex-col items-center justify-center text-xs py-2 text-gray-500 bg-white hover:bg-blue-50 rounded-lg">
                    <span class="text-lg">ğŸ“</span> æœåŠ¡
                </button>
            </div>
        </div>
    </div>
    
    <!-- æ¡£æ¡ˆæ–°å»º Modal -->
    <div id="profile-creation-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center modal-bg transition duration-300">
        <div class="bg-white p-6 rounded-xl shadow-2xl w-11/12 max-w-md">
            <h3 class="text-2xl font-bold text-gray-800 mb-4 border-b pb-2">ğŸ‘¶ åˆ›å»ºæ–°æ¡£æ¡ˆ</h3>
            <!-- Form fields (Name, Age, Province) -->
            <div class="space-y-3">
                <label class="block"><span class="text-sm font-medium text-gray-600">å­©å­å§“å/ä»£å·</span><input type="text" id="profile-name" class="mt-1 block w-full border border-gray-300 rounded-lg p-2" placeholder="ä¾‹å¦‚ï¼šæ˜Ÿæ˜Ÿ / å°æ˜"></label>
                <label class="block"><span class="text-sm font-medium text-gray-600">å¹´é¾„ (å²)</span><input type="number" id="profile-age" class="mt-1 block w-full border border-gray-300 rounded-lg p-2" min="1" max="18" placeholder="ä¾‹å¦‚ï¼š5"></label>
                <label class="block"><span class="text-sm font-medium text-gray-600">æ‰€åœ¨çœä»½</span><select id="profile-province" class="mt-1 block w-full border border-gray-300 rounded-lg p-2">
                    <option value="">-- è¯·é€‰æ‹© --</option><option value="åŒ—äº¬">åŒ—äº¬</option><option value="ä¸Šæµ·">ä¸Šæµ·</option><option value="å¹¿ä¸œ">å¹¿ä¸œ</option><option value="æ±Ÿè‹">æ±Ÿè‹</option><option value="æµ™æ±Ÿ">æµ™æ±Ÿ</option><option value="å››å·">å››å·</option><option value="æ¹–åŒ—">æ¹–åŒ—</option><option value="å…¶ä»–">å…¶ä»–/æµ·å¤–</option>
                </select></label>
            </div>
            <button onclick="submitNewProfile()" id="profile-creation-button" class="mt-6 w-full py-3 bg-green-600 text-white font-bold rounded-xl hover:bg-green-700 transition">
                åˆ›å»ºæ¡£æ¡ˆå¹¶å¼€å§‹æµ‹è¯„
            </button>
            <p id="profile-creation-status" class="text-center text-sm mt-3 text-gray-500"></p>
        </div>
    </div>
    
    <!-- æµ‹è¯„ç»“æœ Modal (æ–°éœ€æ±‚) -->
    <div id="assessment-result-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center modal-bg transition duration-300">
        <div class="bg-white p-6 rounded-xl shadow-2xl w-11/12 max-w-md max-h-[90vh] overflow-y-auto">
            <h3 class="text-2xl font-bold text-blue-600 mb-4 border-b pb-2">ğŸ‰ æµ‹è¯„ç»“æœ - ç®€è¦åˆ†æ</h3>
            
            <div class="flex justify-between items-center mb-4 p-3 bg-blue-50 rounded-lg">
                <p class="text-sm text-gray-600">æ€»å¾—åˆ† / æ»¡åˆ†: <span id="result-score" class="font-bold text-blue-700">0 / 36 åˆ†</span></p>
                <p class="text-sm text-gray-600">åˆæ­¥å®šçº§: <span id="result-level" class="font-bold text-red-700">å¸¸è§„å‘å±•çº§</span></p>
            </div>

            <div class="space-y-4">
                <div class="bg-gray-50 p-3 rounded-lg border">
                    <p class="font-semibold text-gray-700 mb-1">è¯„ä¼°ç»“æœ (100å­—å†…)</p>
                    <p id="result-summary" class="text-sm text-gray-600 leading-relaxed"></p>
                </div>
                
                <div class="bg-gray-50 p-3 rounded-lg border">
                    <p class="font-semibold text-gray-700 mb-1">åˆæ­¥æŒ‡å¯¼å»ºè®®</p>
                    <p id="result-guidance" class="text-sm text-gray-600 leading-relaxed"></p>
                </div>
            </div>

            <!-- ä»˜è´¹æµ‹è¯„æç¤º -->
            <div class="mt-6 p-4 bg-yellow-100 rounded-xl border-l-4 border-yellow-500">
                <p class="font-bold text-red-600 text-lg mb-1">ğŸ’¡ æç¤ºï¼šå‡çº§ä¸“ä¸šæµ‹è¯„ï¼</p>
                <p class="text-sm text-gray-700">
                    è‡ªæµ‹ç»“æœä»…ä¾›å‚è€ƒã€‚ä»˜è´¹ä¸“ä¸šç‰ˆå°†ç»“åˆ<span class="font-bold">åŒ»é™¢è¯Šæ–­ã€ç¯å¢ƒå› ç´ </span>ç­‰ï¼Œæä¾›æ›´æƒå¨ã€æ›´ä¸ªæ€§åŒ–çš„å¹²é¢„æŒ‡å¯¼å’Œä¸“ä¸šç£å¯¼æœåŠ¡ã€‚
                </p>
                <button onclick="document.getElementById('assessment-result-modal').classList.add('hidden'); switchView('PRO_SERVICE');" 
                        class="mt-3 w-full py-2 bg-red-600 text-white font-bold rounded-lg hover:bg-red-700 transition">
                    äº†è§£ä¸“ä¸šæœåŠ¡
                </button>
            </div>
            
            <button onclick="document.getElementById('assessment-result-modal').classList.add('hidden')" class="mt-4 w-full py-2 bg-gray-200 text-gray-700 font-bold rounded-lg hover:bg-gray-300 transition">
                å…³é—­å¹¶ç»§ç»­ä½¿ç”¨
            </button>

        </div>
    </div>

    <!-- åˆ é™¤ç¡®è®¤ Modal -->
    <div id="confirmation-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center modal-bg transition duration-300">
        <div class="bg-white p-6 rounded-xl shadow-2xl w-11/12 max-w-sm">
            <h3 class="text-xl font-bold text-red-600 mb-3">â— ç¡®è®¤åˆ é™¤</h3>
            <p class="text-gray-700 mb-6">æ‚¨ç¡®å®šè¦æ°¸ä¹…åˆ é™¤æ¡£æ¡ˆ <span class="font-bold text-red-700" id="confirm-guide-name">[æ¡£æ¡ˆåç§°]</span> å—ï¼Ÿ</p>
            <div class="flex justify-end space-x-3">
                <button onclick="document.getElementById('confirmation-modal').classList.add('hidden')" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300">å–æ¶ˆ</button>
                <button onclick="performDelete()" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">ç¡®è®¤åˆ é™¤</button>
            </div>
        </div>
    </div>
    
    <!-- é”™è¯¯/ä¿¡æ¯æç¤º Modal -->
    <div id="error-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center modal-bg transition duration-300">
        <div class="bg-white p-6 rounded-xl shadow-2xl w-11/12 max-w-sm">
            <h3 class="text-xl font-bold text-yellow-600 mb-3">æ³¨æ„</h3>
            <p class="text-gray-700 mb-6" id="error-message">å‘ç”Ÿäº†ä¸€ä¸ªæ“ä½œé”™è¯¯ã€‚</p>
            <div class="flex justify-end">
                <button onclick="document.getElementById('error-modal').classList.add('hidden')" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">ç¡®å®š</button>
            </div>
        </div>
    </div>
</body>
</html>

